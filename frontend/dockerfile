# --- ç¬¬ä¸€éšæ®µï¼šæ‰“åŒ… (Builder) ---
FROM node:22-alpine AS builder

WORKDIR /app

# [cite_start]è¤‡è£½ package è¨­å®šæª” [cite: 7]
COPY package.json package-lock.json ./
RUN npm install

# è¤‡è£½å‰ç«¯ç¨‹å¼ç¢¼
COPY . .

# ğŸ”¥ è¨­å®šå¾Œç«¯ API ç¶²å€ (é€™æœƒåœ¨éƒ¨ç½²æ™‚ç”±å¹³å°æ³¨å…¥ï¼Œæˆ–è€…é è¨­)
ARG VITE_API_URL
ENV VITE_API_URL=${VITE_API_URL}

# [cite_start]åŸ·è¡Œ Vite æ‰“åŒ… (æœƒç”¢ç”Ÿ dist è³‡æ–™å¤¾) [cite: 7]
RUN npm run build

# --- ç¬¬äºŒéšæ®µï¼šåŸ·è¡Œ (Runner) ---
# ä½¿ç”¨ Nginx ä¾†ä¼ºæœéœæ…‹ç¶²é ï¼Œè¼•é‡åˆå¿«
FROM nginx:alpine

# å°‡æ‰“åŒ…å¥½çš„ dist è³‡æ–™å¤¾è¤‡è£½åˆ° Nginx é è¨­ç›®éŒ„
COPY --from=builder /app/dist /usr/share/nginx/html

# è®“ Nginx ç›£è½ 80 port
EXPOSE 80

CMD ["nginx", "-g", "daemon off;"]